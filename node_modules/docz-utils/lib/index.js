"use strict";function _interopDefault(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var parser=require("@babel/parser"),traverse=_interopDefault(require("@babel/traverse")),vfile=_interopDefault(require("to-vfile")),unified=_interopDefault(require("unified")),remark=_interopDefault(require("remark-parse")),matter=_interopDefault(require("remark-frontmatter")),slug=_interopDefault(require("remark-slug")),parseFrontmatter=_interopDefault(require("remark-parse-yaml")),find=_interopDefault(require("unist-util-find")),is=_interopDefault(require("unist-util-is")),visit=_interopDefault(require("unist-util-visit")),humanize=_interopDefault(require("humanize-string")),flatten=_interopDefault(require("lodash.flatten")),get=_interopDefault(require("lodash.get")),jsxUtils=require("jsx-ast-utils"),strip=_interopDefault(require("strip-indent")),generator=require("@babel/generator"),generator__default=_interopDefault(generator),path=require("path"),codesandboxerFs=require("codesandboxer-fs"),prettier=require("prettier"),logger=_interopDefault(require("signale"));const valueFromTraverse=(e,r=(e=>e))=>t=>{let a="";const o=parser.parse(t,{plugins:["jsx"]});return traverse(o,{enter(t){if(e(t))return a=r(t),void t.stop()}}),a},codeFromNode=e=>r=>valueFromTraverse(e,e=>r.slice(e.node.start,e.node.end))(r);var ast=Object.freeze({valueFromTraverse:valueFromTraverse,codeFromNode:codeFromNode});const parseMdx=e=>{const r=vfile.readSync(e,"utf-8"),t=unified().use(remark,{type:"yaml",marker:"-"}).use(matter).use(parseFrontmatter).use(slug);return t.run(t.parse(r))},getChildValue=e=>e.map(e=>e.children?getChildValue(e.children):e.value),valueFromHeading=e=>{const r=get(e,"children"),t=get(e,"data.id");return Array.isArray(r)?flatten(getChildValue(r)).filter(Boolean).join(" "):humanize(t)},headingsFromAst=e=>{const r=[];return visit(e,"heading",e=>{const t=get(e,"data.id"),a=get(e,"depth");r.push({depth:a,slug:t,value:valueFromHeading(e)})}),r},getParsedData=e=>{const r=find(e,e=>is("yaml",e));return get(r,"data.parsedValue")||{}};var mdast=Object.freeze({parseMdx:parseMdx,headingsFromAst:headingsFromAst,getParsedData:getParsedData});const propFromElement=e=>valueFromTraverse(e=>e.isJSXOpeningElement(),r=>jsxUtils.getPropValue(jsxUtils.getProp(r.node.attributes,e))),removeTags=e=>{const r=codeFromNode(e=>e.isJSXOpeningElement()),t=codeFromNode(e=>e.isJSXClosingElement());return e.replace(r(e),"").replace(t(e),"")},sanitizeCode=e=>{const r=strip(e).trim(),t=r.startsWith("{")&&r.endsWith("}")?r.substr(1,r.length-2):r;return strip(t).trim().replace(/'/g,"\\'").replace(/`/g,"\\`")},componentName=e=>{const r=e.match(/^\<\\?(\w+)/);return r&&r[1]};var jsx=Object.freeze({propFromElement:propFromElement,removeTags:removeTags,sanitizeCode:sanitizeCode,componentName:componentName});const fromSpecifiers=(e=[])=>Array.isArray(e)&&e.length>0?e.map(e=>get(e,"local.name")):[],traverseOnImports=e=>r=>{try{const t=parser.parse(r.value,{sourceType:"module"});let a=[];return traverse(t,{enter(r){r.isImportDeclaration()&&"docz"!==get(r,"node.source.value")&&(a=a.concat(e(r)))}}),a}catch(e){return[]}},getFullImports=traverseOnImports(e=>[get(generator__default(e.node),"code")]),getImportsVariables=traverseOnImports(e=>fromSpecifiers(e.node.specifiers));var imports=Object.freeze({getFullImports:getFullImports,getImportsVariables:getImportsVariables});const wrapCode=e=>`import React from 'react';\n\nconst doczStyles = {\n  margin: '0 3px',\n  padding: '4px 6px',\n  fontFamily: '"Source Code Pro", monospace',\n  fontSize: 14,\n};\n\nconst App = ({ children }) => (\n  <div style={doczStyles}>\n    {children && typeof children === 'function' ? children() : children}\n  </div>\n)\n\nexport default () => (\n  <App>\n    ${e.split("\n").join("\n    ")}\n  </App>\n)`;function getSandboxFiles(e,r,t){const a=[...r,wrapCode(e)].join("\n"),o=path.join(t,"codesandbox.example.csb.js");return codesandboxerFs.assembleFiles(o,{extensions:[".js",".ts",".jsx",".tsx"],contents:a})}const getSandboxImportInfo=async(e,r,t)=>{let a;try{const{parameters:o}=await getSandboxFiles(e,r,t);a=o}catch(e){console.error("Could not create Open in CodeSandbox",e)}return a};var codesandbox=Object.freeze({getSandboxImportInfo:getSandboxImportInfo});const format=e=>new Promise((r,t)=>{try{r(prettier.format(e,{parser:"babylon",semi:!1,singleQuote:!0,trailingComma:"all"}))}catch(e){logger.fatal(e),r(e)}});function namedAssetImport({types:e}){const r=new WeakSet;return{visitor:{ImportDeclaration(t,{opts:{loaderMap:a}}){const o=t.node.source.value,n=path.extname(o).substr(1);r.has(t.node)||-1!==o.indexOf("!")||a[n]&&t.replaceWithMultiple(t.node.specifiers.map(t=>{if(e.isImportDefaultSpecifier(t)){const a=e.importDeclaration([e.importDefaultSpecifier(e.identifier(t.local.name))],e.stringLiteral(o));return r.add(a),a}const s=e.importDeclaration([e.importSpecifier(e.identifier(t.local.name),e.identifier(t.imported.name))],e.stringLiteral(a[n][t.imported.name]?a[n][t.imported.name].replace(/\[path\]/,o):o));return r.add(s),s}))}}}}exports.ast=ast,exports.mdast=mdast,exports.format=format,exports.imports=imports,exports.jsx=jsx,exports.codesandbox=codesandbox,exports.namedAssetImport=namedAssetImport;
